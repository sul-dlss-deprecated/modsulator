#!/usr/bin/env ruby

require 'modsulator'

modsulator = Modsulator.new

unless ARGV.length == 3
  abort "Usage: modsulator <spreadsheet filename> <XML template filename> <output directory>"
end

if(File.exists?(ARGV[0]) && File.readable?(ARGV[0]))
  spreadsheet_rows = modsulator.load_spreadsheet(ARGV[0])
else abort "*** The file #{ARGV[0]} does not exist or is not readable to the current user? - Terminating."
end

if(File.exists?(ARGV[1]) && File.readable?(ARGV[1]))
  mods_template_xml = IO.read(ARGV[1])
else abort "*** The file #{ARGV[1]} does not exist or is not readable to the current user? - Terminating."
end

invalid_headers = modsulator.validate_headers(spreadsheet_rows[0].keys, mods_template_xml)
if(invalid_headers.length > 0)
  puts("*** Warning: There were headers in the spreadsheet that did not appear in the XML template (is there a spreadsheet typo?):")
  invalid_headers.each do |h|
    puts(h)
  end
end

modsulator.generate_normalized_mods(ARGV[1], ARGV[0], ARGV[2])
